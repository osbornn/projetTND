---
title: "Projet TND"
authors: "Alessandro Rinaudo(21701590) et Alberto Petrossi(21701689)"
date: "4/21/2020"
info : "Ce projet a été réalisé en binôme"
output: html_document
---

# Partie 1 : Analyse descriptive

## Question 1 
#### Téléchargement du jeu de données et chargement sur R
```{r partie1.1}
covid.19=read.csv("donnees_covid.csv", sep = ";")
```

## Question 2

#### Description du jeu de données 
```{r partie1.description}
# Dataframe contenant les donnéés avec 8 variables 
#maille_nom : nom des provinces françaises
#
```
#### Calcul de la dimension
```{r partie1.2.1}
dim(covid.19)
```

#### Nom variables
```{r partie1.2.2}
names(covid.19)
```

#### Type variable 
```{r partie1.2.3}
typeof(covid.19)
```

#### Statistiques générales 
```{r partie1.2.4}
summary(covid.19)
```

#### Calcul de l'écart type 
```{r partie1.2.5}
apply (covid.19[,-1],2,sd)
```

#### Réalisation boite à moustache
```{r partie1.2.6}
boxplot(covid.19[,-1])
```

#### Réalisation histogrammes
```{r partie1.2.7}
hist(covid.19$duree_jours)
hist(covid.19$latitude)
hist(covid.19$longitude)
hist(covid.19$deces_total)
hist(covid.19$reanimation_total)
hist(covid.19$hospitalises_total)
hist(covid.19$gueris_total)
```

## Question 3

#### Affichage de la carte géographique 
```{r partie1.3.1}
#Loading stuff
library(leaflet)
```

#### Couleurs
```{r partie1.3.1.2}
mybins = seq(min(covid.19$deces_total), max(covid.19$deces_total), by=2000)
mypalette = colorBin( palette = "YlOrRd", domain=covid.19$deces_total, na.color="transparent", bins=mybins)
```

#### Preparation du texte pour la info-bulle:
```{r partie1.3.1.3}
mytext = paste(
  "Deces totaux: ", covid.19$deces_total, "<br/>", 
  "Reanimations totales : ", covid.19$reanimation_total, "<br/>", 
  "Hospitalises totaux : ", covid.19$hospitalises_total, "<br/>",
  "Gueris totaux : ", covid.19$gueris_total, sep = "") %>%
  lapply(htmltools::HTML)
```

#### Création de la carte
```{r partie1.3.1.4}
m = leaflet(covid.19) %>% 
  addTiles()  %>% 
  setView( lat=48, lng=2 , zoom=5) %>%
  addProviderTiles("Esri.WorldImagery") %>%
  addCircleMarkers(~longitude, ~latitude, 
                  fillColor = ~mypalette(covid.19$deces_total), fillOpacity = 0.7, color="white", radius=8, stroke=FALSE,
                   label = mytext,
                   labelOptions = labelOptions( style = list("font-weight" = "normal", padding = "3px 8px"), textsize = "13px", direction = "auto")
  ) %>%
  addLegend( pal=mypalette, values=~deces_total, opacity=0.9, title = "Nombre de morts", position = "bottomright" )

m 
```


# Partie 2 : Prédiction du nombre de décès

## Question 1 

#### Calcul de la corrélation entre les variables "reanimation_total" , "hospitalisation_total" , "gueris_total"
```{r partie2.1.1}
cor(covid.19[,-c(1:5)])
```

#### Affichage matrice de corrélation
```{r partie2.1.1.2}
#install.packages("corrplot")
M=cor(covid.19[,-c(1:5)])
library(corrplot)
corrplot(M, method="circle")
```

## Question 2

#### Affichage nouages de points
```{r partie2.2}
help("plot")
plot(covid.19[c(5:6)])
plot(covid.19$deces_total,covid.19$hospitalises_total)
plot(covid.19$deces_total,covid.19$gueris_total)
```

#### Les variables qui permettent d'expliquer au mieux la variable à prédire sont les variables "hospitalises_total" et "reanimation_total", car elles permettent de se faire une idée sur le nombre potentiel de personnes décédées. 

## Question 3

#### Division du jeu de données en deux sous-ensemble (80%-20%)
```{r partie2.3}
sample = sample.int(n = nrow(covid.19), size = floor(.80*nrow(covid.19)))
apprentissage = covid.19[sample, ]
test  = covid.19[-sample, ]

apprentissage
test

```


## Question 4

#### Régression linéaire entre les variables explicatives et la variable à expliquer
```{r partie2.4}
regLi = lm(deces_total~reanimation_total + hospitalises_total + gueris_total, data = apprentissage)
plot(regLi)

#Sur le premier graphique, on observe que les résidus sont dispersés de manière égale autour de la droite horizontale sans suivre une forme de fonction distincte. Donc le mode de régression est bon et il a une bonne capacité de généralisation. 

#Sur le deuxième graphique (Q-Q plot), on observe qu'il suit une ligne droite. On en déduit que le modèle est bon.

#Sur le troisième graphique (Scale-Location), on constate que les résidus se dispersent après la valeur prédite 0. Par conséquent le modèle n'a pas une bonne généralisation. 


```

## Question 6

#### Création de la fonction MAE (Min Absolute Error) et MSE (Min Squared Error)
```{r partie2.6}
MAE = function(y_reel, y_est)
{
val = abs(y_reel-y_est)
mae_cal = mean(val)
return(mae_cal)
}

MSE = function(y_reel, y_est)
{
val = (y_reel-y_est)^2
mse_cal = mean(val)
return(mse_cal)
}
```

#### Calcul du MAE et MSE graçe à les fonctions crées précédemment
```{r partie2.6.2}
y_estime = predict(regLi)

MAE(apprentissage$deces_total, y_estime)
MAE(test$deces_total, y_estime)

MSE(apprentissage$deces_total, y_estime)
MSE(test$deces_total, y_estime)
```

# Partie 3 : clustering des départements selon la dynamique de propagation du virus

## Question 1


```{r partie3.1}


```


